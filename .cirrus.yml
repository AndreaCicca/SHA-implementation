task:
  arm_container:
    image: ubuntu:20.04

  environment:
    CONAN_USER_HOME: /root/.conan2

  # conan_cache:
  #   folder: $HOME/.conan2  # Percorso della cartella Conan2
  #   fingerprint_script:
  #     - cat ./src/conanfile.txt

  env:
    DEBIAN_FRONTEND: noninteractive
    TZ: Europe/Rome

  setup_script:
    # Installa git, Conan, e strumenti di compilazione C++
    - apt update
    - apt install -y git python3-pip g++ cmake build-essential

    # Installa Conan
    - pip3 install conan

  checkout_script:
    - git clone https://github.com/AndreaCicca/SHA-implementation .
    - git checkout main

  install_script:
    # Crea il profilo di Conan e directory build
    - conan profile detect --force
    - mkdir -p src/build

  build_script:
    # Installa le dipendenze con Conan e build con CMake
    - conan install src --output-folder=src/build --build=missing
    - cmake -S src -B src/build --preset conan-release
    - cmake --build src/build
